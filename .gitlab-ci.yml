stages:
  - setup
  - test

# Stage 1: Start Juice Shop
start_juice_shop:
  stage: setup
  script:
    - npm start &                        
    - sleep 20                           
  tags:
    - tim-mac

# Stage 2: Run Zest Penetration Test
run_zest_tests:
  stage: test
  script:
    - pkill -f zap || true
    - zap.sh -cmd -script /Users/timothytay/Desktop/sweng2025/sweng25_group36-workdaysecurity/zest-scrips/simpleTest01.zst
    - if grep -q "ALERT" ~/.ZAP/zap.log; then
        echo "Security vulnerability detected in simpleTest01!";
      else
        echo "No vulnerabilities found in simpleTest01.";
      fi
    - zap.sh -cmd -script /Users/timothytay/Desktop/sweng2025/sweng25_group36-workdaysecurity/zest-scrips/advancedTest01.zst
    - if grep -q "ALERT" ~/.ZAP/zap.log; then
        echo "Security vulnerability detected in advancedTest01!";
      else
        echo "No vulnerabilities found in advancedTest01.";
      fi
  tags:
    - tim-mac
  dependencies:
    - start_juice_shop
